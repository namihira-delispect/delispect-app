# 非機能要件

## 1. 性能要件

研究開発用途として耐えれば良いのであからさまに遅延が発生しなければ十分である。（ユーザーがストレスを感じなければ良い）
以下に参考程度の性能要件を示す。

### 1.1 導入を想定する病院の例
一般病棟 、巡回時に同時接続がある想定
- 病床数: 200 ~ 300
- ユーザー数: 10 ~ 20名

### 1.2 サーバー要件
- OS: Linux系OS
- CPU: 4コア以上
- メモリ: 16GB以上（機械学習モデルの規模や導入病院の病床数に応じて増設を検討）
- ストレージ: SSD 1TB以上

### 1.3 レスポンスタイム要件

想定負荷条件は1.1に基づく（同時接続ユーザー数: 10〜20名）。

| 処理種別 | 目標レスポンスタイム | 備考 |
|---------|-------------------|------|
| 画面表示（一覧・詳細） | 3秒以内 | 初回表示。キャッシュ有効時は1秒以内 |
| データ更新（ケアプラン保存等） | 2秒以内 | |
| 電子カルテ同期 | 60秒以内 | 対象患者数に依存。バックグラウンド処理 |
| リスク評価（ML推論） | 120秒以内 | 対象患者数・モデル規模に依存。バックグラウンド処理 |

## 2. セキュリティ要件

### 2.1 アクセス制御
- ユーザー認証
  - ユーザーIDとパスワードによる認証
  - パスワードは12文字以上で、大文字・小文字・数字・記号を組み合わせたものを要求
- アクセス権限管理
  - 一般ユーザー（看護師・医師）、システム管理者、全権管理者の3つのロールを定義
  - 各ロールに応じた機能へのアクセス制限
  - 患者情報へのアクセスは必要最小限の権限のみ付与

### 2.2 データ保護
- 通信の暗号化
  - 病院内のプライベートネットワーク環境に応じた通信方式の採用
  - 可能な環境ではHTTPSによる通信の暗号化を実施
  - プライベートネットワーク内での通信は病院のセキュリティポリシーに準拠
- データの暗号化
  - 個人情報は保存時に暗号化
  - 暗号化キーは定期的なローテーション
- データバックアップ
  - ストレージの冗長化（RAID等）
  - 可能な環境では日次でのフルバックアップを実施
  - バックアップデータの暗号化

### 2.3 CSRF対策
- 認証基盤のフレームワーク標準機能（CSRFトークン検証、SameSite Cookie）で対応する
- 重要な操作時の再認証（パスワード変更等）

### 2.4 エラー情報の保護
- エラーメッセージに機密情報（患者情報、認証情報等）を含めない
- スタックトレースは開発環境のみ表示し、本番環境では非表示

### 2.5 監査ログ
記録対象の詳細は [8.監査ログ機能](5_functional_requirements/8_audit_log.md) を参照。

- ログの保持期間: 5年間
- リクエストIDによるトレーサビリティの確保
- インシデント発生時の原因追跡が可能であること
- エラーログに含まれる個人情報はマスキング処理を行う

## 3. 可用性要件
- システム稼働時間
  - 24時間365日の稼働
  - 計画メンテナンス時を除く
- 障害時の復旧時間
  - 重大障害：4時間以内
  - 軽微な障害：24時間以内
- フェイルセーフ
  - エラー処理自体の失敗に対する安全側への倒し込み
  - ログストレージ容量の監視・ローテーション

## 4. 保守性要件
- モジュール化された設計により、個別機能の修正・更新が他機能に影響しにくい構成とする
- 緊急パッチ適用時の迅速な対応が可能であること
- 障害発生時のエスカレーションルートの確立

## 5. 拡張性要件
- 導入先の病院規模（病床数・ユーザー数）の違いに対し、設定変更やサーバースペックの増強で対応可能とする
- ケアプラン項目やリスク評価モデルの追加・変更に対応しやすい設計とする

## 6. インターフェース要件

### 6.1 ユーザーインターフェース
- 画面設計
  - PCでの利用を想定
  - 視認性の高いフォントサイズとコントラスト
- 操作性
  - 直感的な操作が可能なUI
  - エラー時のユーザーが理解しやすいメッセージ表示
  - リトライ可能なエラーに対する再試行手段の提供
  - ヘルプ機能の実装

### 6.2 外部システム連携
- 電子カルテ同期（EMR Sync）
  - 病院DBへの直接接続によるデータ取得
  - データマッピング機能により病院固有のコード体系に対応
  - 手動同期および日次バッチ同期の2方式をサポート
- バックアップ
  - 定期的なデータバックアップ
  - リストア機能

## 7. テスト要件

### 7.1 テスト方針
- テストレベル
  - 単体テスト
  - 結合テスト
  - システムテスト
  - 受け入れテスト
- テスト環境
  - 開発環境
  - ステージング環境（本番相当のデータ・構成で検証）

### 7.2 テスト項目
- 機能テスト
  - 各機能の正常系/異常系テスト
  - エッジケースのテスト
- 非機能テスト
  - 負荷テスト
  - セキュリティテスト
  - 業務適合性テスト（実際の業務フローに沿った操作テスト）

## 8. 運用・保守要件

### 8.1 運用体制
- 監視体制
  - 病院内での定期巡回によるシステム状態の確認
    - サーバーの物理状態確認（電源、冷却、ケーブル接続）
    - アプリケーションの動作確認
    - ディスク容量の確認
  - システムログの定期確認
  - 異常検知時の院内担当者への報告フロー
- ユーザーサポート
  - ヘルプデスクの設置
    - システム利用に関する問い合わせ対応
    - トラブル発生時の初動対応
  - トラブル対応フロー
    - トラブル内容の記録
    - 対応状況の管理
    - 解決後の報告
- バックアップ
  - 日次バックアップの実施
  - バックアップデータの検証

### 8.2 保守体制
- 定期メンテナンス
  - 月1回の定期メンテナンス（計画停止を伴う場合は事前通知）
  - システム更新時のステージング環境でのテスト実施
- 障害対応
  - 障害発生時の初動対応と院内担当者への連絡
  - 復旧作業の実施

## 9. 移行要件

### 9.1 初期導入
- 環境構築
  - サーバーセットアップ、アプリケーションのデプロイ
  - 病院ネットワークへの接続設定
- データ準備
  - データマッピング設定（病院DBのコード体系との対応付け）
  - 薬剤マスタ・基準値マスタの初期データ投入
  - 電子カルテ同期の疎通確認
- ユーザー準備
  - ユーザーアカウントの作成
  - 利用者向け操作研修の実施

### 9.2 システム更新
- 更新手順
  - 更新計画の策定（更新内容、実施日時、影響範囲の確認）
  - ユーザーへの事前通知（メンテナンス時間の周知）
  - メンテナンス実施（アプリケーションの停止、更新作業）
  - 動作確認（各機能の正常動作確認）
- リスク対策
  - 更新失敗時のロールバック手順
  - 緊急時の連絡体制
