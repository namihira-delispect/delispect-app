# 12.データマッピング

## 機能概要
電子カルテ同期時に、病院DB上の検査コード・処方コード等を本システムの項目に対応付けるためのマッピング設定機能。
病院DBでは検査値や処方が正規化されており、同一項目（例：WBC）でも検査方法ごとに異なるコードが存在する。
本機能により、病院ごとのコード体系の違いをコード修正なしに吸収する。

## 前提条件
- システム管理者または全権管理者でログインしていること

## 機能要件

### 12.1 検査値マッピング
病院DBの検査コードと本システムの検査項目を対応付ける。

#### 12.1.1 マッピング一覧表示
- システムの検査項目ごとに、対応付けられた病院側コードを一覧表示する
- マッピング済み/未設定のステータスを表示する

#### 12.1.2 マッピング設定
- システムの検査項目に対し、病院DBの検査コード（検査方法含む）を選択・登録する
- 同一検査項目に複数の検査コードが存在する場合、優先順位を設定できる
- マッピング対象のシステム検査項目:

| カテゴリ | 項目 |
|---------|------|
| 血液一般検査（CBC） | RBC, WBC, Hb, Ht, Plt |
| 生化学検査 | AST, ALT, ALP, γ-GT, ChE, CRE, UN, Na, K, Ca, GLU, CRP |

### 12.2 処方マッピング
病院DBの処方コードと本システムの薬剤マスタを対応付ける。

#### 12.2.1 マッピング一覧表示
- 薬剤マスタの薬剤ごとに、対応付けられた病院側処方コードを一覧表示する
- マッピング済み/未設定のステータスを表示する

#### 12.2.2 マッピング設定
- 薬剤マスタの薬剤に対し、病院DBの処方コードを選択・登録する

### 12.3 バイタルサインマッピング
病院DBのバイタル項目コードと本システムのバイタル項目を対応付ける。

#### 12.3.1 マッピング設定
- マッピング対象のシステムバイタル項目:

| 項目 |
|------|
| 体温 |
| 脈拍 |
| 収縮期血圧 |
| 拡張期血圧 |
| SpO2 |
| 呼吸数 |

### 12.4 入院情報マッピング
病院DBの入院情報項目と本システムの項目を対応付ける。

#### 12.4.1 マッピング設定
- マッピング対象のシステム項目:

| 項目 |
|------|
| 病棟 |
| 病室 |

### 12.5 マッピングの検証
- 電子カルテ同期に必要な項目がすべてマッピング済みかを検証する機能
- 未設定の項目がある場合、警告を表示する

## 制約条件
- マッピング設定はシステム管理者または全権管理者に限定される
- マッピング変更は監査ログに記録する
- 導入時に初期設定が必要（未設定の場合、電子カルテ同期は実行不可とする）

## エラー処理
- 保存エラー時の処理
  - マッピングの保存に失敗した場合、エラーメッセージを表示する
- 重複マッピングエラー時の処理
  - 同一の病院側コードが異なるシステム項目に重複登録された場合、警告を表示する
