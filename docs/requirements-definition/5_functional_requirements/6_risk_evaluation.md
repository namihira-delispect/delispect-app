# 6.せん妄リスク評価

## 機能概要
ML APIに入院IDリストを渡し、せん妄リスク評価を実施する。
入力データの準備（DB参照・特徴量抽出）はML API側が担当する。

- せん妄リスク判定モデル
    - 入院IDをインプットとし、リスクを２段階（高・低）で出力する。もしくは判定不能として返す。
    - 評価に必要な項目が不足していれば、不足項目名を返却する。

## 前提条件
- 患者の入院情報が登録されていること
- ハイリスクケア加算のアセスメントが実施されていること

## 機能要件

### 6.1 リスク評価実行機能
患者入院一覧画面にトリガーとなるボタンを配置する。
ML予測の入力にはMedicalHistory（既往歴・リスク因子）のユーザー入力が必要なため、自動実行ではなくユーザーによる手動トリガーとする。
電子カルテ情報の入力ミスや不足情報があった場合にも再実行できるよう、任意のタイミングで実行可能とする。

### 6.2 一括評価機能
患者入院一覧から任意のレコードを選択し、選択したレコードに対して一括でリスク評価を実行する。
選択可能なレコード数は上限50件とする。

### 6.3 特徴量抽出（ML API側）
ML APIが入院IDを受け取り、DBから必要なデータを取得して機械学習の入力値へ変換する。

#### 6.3.1 薬剤パラメータ変換
処方薬剤をリスク薬剤一覧と突き合わせ、機械学習のインプットデータの形に変換する。

#### 6.3.2 インプット項目抽出
患者入院情報（バイタルサイン・採血結果・既往歴等）から必要な項目を抽出し、機械学習の入力形式に変換する。

## 制約条件
- 機械学習サーバーとの連携が必要
- 一括評価の上限は50レコード
- 評価済みの患者に対し再度実施した場合、既存のレコードを更新する
- 採血結果やバイタルサイン等の機械学習入力情報も評価ごとに毎回保存する

## エラー処理
- 機械学習サーバー連携エラー時の処理
  - エラーが発生した場合、エラーメッセージを表示する
  - 再試行可能な場合は再試行ボタンを表示する
- データ不足エラー時の処理
  - リスク評価に必要な項目が不足している場合、不足項目を一覧表示する
- 入力値エラー時の処理
  - 一括評価の上限を超える場合、エラーメッセージを表示する
