# 10.解析用操作ログ

## 機能概要
臨床研究およびユーザー行動分析を目的とした操作ログの収集・エクスポート機能を提供する。
本機能は病院側クライアントではなく、開発・研究チームがシステムの有効性評価やUX改善のために使用する。

## 前提条件
- 監査ログ機能（8章）とは目的が異なり、独立した機能として運用する
- ログデータは個人を特定できない形式でエクスポート可能とする

## 機能要件

### 10.1 個人情報のマスキング
解析用ログは収集時点で個人情報をマスキングし、保存データに個人を特定可能な情報を含めない。

- 患者ID・ユーザーIDは匿名化IDに置換して記録する
- 患者氏名・ユーザー氏名はログに記録しない
- 匿名化IDは同一人物の行動を追跡可能とするが、元のIDへの逆引きはできない仕組みとする

### 10.2 操作ログ収集
#### 10.2.1 画面操作ログ
以下の操作を記録する：
- 画面遷移（遷移元・遷移先・タイムスタンプ）
- 画面滞在時間
- ボタン・リンクのクリック操作
- フォーム入力の開始・完了タイミング

#### 10.2.2 業務フローログ
以下の業務イベントを記録する：
- 電子カルテ同期の実行（対象件数・所要時間）
- リスク評価の実行（対象件数・判定結果の分布）
- ケアプラン作成フロー（開始・各ステップの完了・中断・完了）
- ケアプラン各項目の入力内容と提案結果
- ハイリスクケア加算判定の実行と結果
- 看護記録転記の実行

#### 10.2.3 臨床研究用データ
以下のデータを記録・集計可能とする：
- 入院からケアプラン作成完了までの所要時間
- リスク評価結果（高/低）の分布
- 各ケアプラン項目（薬剤・疼痛・脱水・便秘・炎症・離床・認知症・安全管理・睡眠）の作成実施率

### 10.3 ログエクスポート
#### 10.3.1 エクスポート形式
- CSV形式でのエクスポート
- エクスポート対象期間の指定

#### 10.3.2 エクスポート時の確認
- 10.1のマスキングにより、エクスポートデータには個人情報が含まれないことを保証する

### 10.4 集計ダッシュボード
管理画面内に基本的な集計情報を表示する。

#### 10.4.1 利用状況サマリー
- 期間別のログイン数
- 機能別の利用回数
- ケアプラン作成完了率

#### 10.4.2 臨床指標サマリー
- リスク評価の実施率（対象患者に対する判定実施割合）
- ケアプラン作成率（リスク評価済み患者に対する作成割合）
- ケアプラン項目別の作成実施率

## 非機能要件

### 10.5 パフォーマンス要件
- ログ収集による通常操作への影響を最小限とする
- エクスポート処理はバックグラウンドで実行可能とする

### 10.6 セキュリティ要件
- ログデータへのアクセスは管理者権限に限定
- エクスポート操作自体を監査ログに記録する

## 制約条件
- ログデータの保持期間は5年間とする（監査ログと同様）
- 匿名化処理は不可逆とし、エクスポート後のデータから個人を特定できないこと

## エラー処理
- ログ収集失敗時は業務操作に影響を与えないこと（ログ欠損を許容）
- エクスポート失敗時はエラーメッセージを表示し、再試行可能とする
