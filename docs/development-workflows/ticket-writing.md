# チケット記述ガイドライン

## 1. 概要

本ドキュメントは、AI駆動開発におけるチケット（タスク）の記述ルールを定義する。
AIエージェントが効率的にタスクを理解・実行できるよう、チケットの構造と記載内容を標準化する。

### 関連ドキュメント

- [開発フロー](./development-flow.md) - 開発サイクル全体
- [ブランチ戦略](./branching-strategy.md) - GitHub Flow、PR規約

---

## 2. チケット構造

### 2.1 階層構造（機能実装・エンハンスメント）

**機能実装やエンハンスメント**の場合、チケットは親子関係で管理する:

```
親チケット（要件）
├── 子チケット: 設計
└── 子チケット: 実装（設計完了後にタスク分割）
    ├── 実装タスク 1
    ├── 実装タスク 2
    └── ...
```

> バグ修正やドキュメント更新など、単独で完結するタスクは親子構造不要。

### 2.2 各レベルの役割

| レベル | 役割 | 作成者 | 担当者 |
|--------|------|--------|--------|
| 親チケット（要件） | ビジネス要件の定義 | PdM / 開発者 | - |
| 設計チケット | 技術設計の実施 | 開発者 | 開発者 + AIエージェント |
| 実装チケット | 具体的な実装タスク | 開発者 | AIエージェント |

### 2.3 子チケットの粒度

1つの子チケット（実装タスク）は以下を満たす粒度とする:

- 1人のAIエージェントが独立して完結できる
- 1つのPRで完了できる
- 明確な完了条件（受入基準）がある
- 他チケットとの依存が最小限

**適切な粒度の例**:
- ✅ 「患者一覧APIの実装」
- ✅ 「患者検索フォームコンポーネントの実装」
- ✅ 「ログインバリデーションエラーの修正」

**粒度が大きすぎる例**:
- ❌ 「患者管理機能の実装」（複数の画面・APIを含む）
- ❌ 「認証システムの構築」（設計から実装まで含む）

**粒度が小さすぎる例**:
- ❌ 「Patientインターフェースの定義」（他と一緒にできる）
- ❌ 「ボタンの色を変更」（単独PRにするほどでない）

---

## 3. チケットテンプレート

[チケットテンプレート](../templates/ticket.md) を参照。

- 要件チケット（親チケット）
- 設計チケット
- 実装チケット（AIエージェント向け）

---

## 4. チケット例

### 4.1 要件チケット例

```markdown
# 患者一覧画面の機能追加

## 概要

病棟に入院中の患者を一覧表示する画面を追加する。

## 背景・目的

看護師が担当患者の状態を一目で把握できるようにし、
ケアの優先順位付けを効率化する。

## ユーザーストーリー

看護師として、入院中の患者一覧を見て、
各患者のケア状況を把握したい。

## 機能要件

- [ ] 入院中の患者を一覧表示できる
- [ ] 患者名で検索できる
- [ ] ケアステータスでフィルタできる
- [ ] 患者をクリックすると詳細画面に遷移する

## 関連ドキュメント

- 設計書: `/docs/design/patient-list.md`
- 画面イメージ: 参考画像のリンク
```

### 4.2 実装チケット例

```markdown
# 患者一覧Server Actionの実装

## 概要

患者一覧画面用のServer Actionを実装する。

## 親チケット

- #100（患者一覧画面の機能追加）

## 関連チケット

- #101（患者一覧画面の設計）※設計チケット

## 背景

患者一覧画面のバックエンド処理を実装する。
フロントエンドからはこのServer Actionを呼び出す。

## 完了条件

- [ ] `getPatientList` Server Actionが実装されている
- [ ] 病棟IDで患者をフィルタできる
- [ ] 患者名で部分一致検索できる
- [ ] ケアステータスでフィルタできる
- [ ] ページネーション（1ページ20件）が実装されている
- [ ] 単体テストが追加されている
- [ ] 既存テストがパスする

## 技術的な指示

### 変更対象ファイル

- `apps/web/src/app/actions/patient.ts`（新規作成）
- `packages/db/src/repositories/patientRepository.ts`（メソッド追加）

### 参照すべきドキュメント・コード

- `docs/standards/coding-guidelines.md` - コーディングガイドライン
- `apps/web/src/app/actions/admission.ts` - Server Actionの実装パターン
- `packages/db/src/repositories/admissionRepository.ts` - Repositoryパターン

### 制約

- `Patient` 型は `@delispect/core` からインポート

## 関連情報

### APIスキーマ

```typescript
// リクエスト
type GetPatientListRequest = {
  wardId: string;
  searchQuery?: string;
  careStatus?: CareStatus;
  page: number;
  perPage: number;
};

// レスポンス
type GetPatientListResponse = {
  patients: Patient[];
  totalCount: number;
  totalPages: number;
};
```

## 依存チケット

- #102: Patient型の定義（完了済み）

